version: '3'

services:
  memcached:
    build:
      context: .
      dockerfile: ./memcached-dockerfile
    image: memcached
    container_name: memcached_server
    expose: 
      - 11211
    ports:
    - "11211:11211"
    restart: always
    command: memcached -u root
  api:
    build: .
    image: flask_restful
    container_name: ldap_api
    environment: 
            - LDAP_API_ENVIRONMENT=${LDAP_API_ENVIRONMENT}
            - FLASK_ENV=${LDAP_API_ENVIRONMENT}
    expose: 
      - 5000
    ports:
    - "${API_HOST_PORT}:5000"
    volumes:
    - .:/api
    restart: always
    working_dir: /api
    command: python run.py
    depends_on: 
      - memcached

networks: 
  default:
    external:
      name: tesis
<!DOCTYPE html>
<!-- saved from url=(0074)https://www.redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html -->
<html class=" js no-touch cssanimations csstransitions" lang="en" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>LDAP and password encryption strength – /techblog</title>
<meta name="description" content="Redpill Linpro Tech Blog">
<meta name="keywords" content="LDAP, security">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="LDAP and password encryption strength">
<meta property="og:description" content="Redpill Linpro Tech Blog">
<meta property="og:url" content="/techblog/2016/08/16/ldap-password-hash.html">
<meta property="og:site_name" content="/techblog">





<link rel="canonical" href="https://www.redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html">
<link href="https://www.redpill-linpro.com/techblog/feed.xml" type="application/atom+xml" rel="alternate" title="/techblog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="./LDAP and password encryption strength – _techblog_files/main.css">
<!-- Webfonts -->
<link href="./LDAP and password encryption strength – _techblog_files/css" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<div class="fit-vids-style">­<style>               .fluid-width-video-wrapper {                 width: 100%;                              position: relative;                       padding: 0;                            }                                                                                   .fluid-width-video-wrapper iframe,        .fluid-width-video-wrapper object,        .fluid-width-video-wrapper embed {           position: absolute;                       top: 0;                                   left: 0;                                  width: 100%;                              height: 100%;                          }                                       </style></div><script src="./LDAP and password encryption strength – _techblog_files/leadflows.js" type="text/javascript" id="LeadFlows-339956" crossorigin="anonymous" data-leadin-portal-id="339956" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="339956" data-hsjs-env="prod"></script><script src="./LDAP and password encryption strength – _techblog_files/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" ungated-for="Conversations:ExternalApiV1" data-loader="hs-scriptloader" data-hsjs-portal="339956" data-hsjs-env="prod"></script><script src="./LDAP and password encryption strength – _techblog_files/339956.js" type="text/javascript" id="hs-script-loader"></script><script id="hs-analytics" src="./LDAP and password encryption strength – _techblog_files/339956(1).js"></script><script async="" src="./LDAP and password encryption strength – _techblog_files/analytics.js"></script><script src="./LDAP and password encryption strength – _techblog_files/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://www.redpill-linpro.com/techblog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://www.redpill-linpro.com/techblog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://www.redpill-linpro.com/techblog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.redpill-linpro.com/techblog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.redpill-linpro.com/techblog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.redpill-linpro.com/techblog/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature"><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important;right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;right:0;content:""}#hubspot-messages-iframe-container .shadow.internal{display:none!important}#hubspot-messages-iframe-container .shadow.active{width:400px;height:400px;background:radial-gradient(ellipse at bottom right,rgba(29,39,54,.16) 0,rgba(29,39,54,0) 72%)}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="nav-header">
  <nav id="dl-menu" class="dl-menuwrapper" role="navigation">
    <button class="dl-trigger">Open Menu</button>
    <ul class="dl-menu">
      <li><a href="https://www.redpill-linpro.com/techblog/">Home</a></li>
      <li><a href="https://www.redpill-linpro.com/techblog/about/">About</a></li>
      <li><a href="https://www.redpill-linpro.com/techblog/feed.xml">RSS Feed</a></li>
      <li><a href="https://www.redpill-linpro.com/techblog/posts/">Show all Posts</a></li>
      <li><a href="https://www.redpill-linpro.com/techblog/tags/">Show all Tags</a></li>
    </ul>
  </nav>

  <div class="logo">
    <a href="https://redpill-linpro.com/"><img src="./LDAP and password encryption strength – _techblog_files/Redpill-Linpro-logo-red-200px.png" alt="Logo"></a>
  </div>
</div>



<div class="entry-header">
  




<div class="image-credit">
  <a target="_blank" href="https://commons.wikimedia.org/wiki/File:Steal_password.jpg" class="image-popup">
    Psyomjesus
  </a>
  | <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0
  </a> 
  
</div>


  <div class="entry-image">
    <img src="./LDAP and password encryption strength – _techblog_files/steal_password.jpg" alt="LDAP and password encryption strength">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="https://www.redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html" rel="bookmark" title="LDAP and password encryption strength">LDAP and password encryption strength</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2016-08-16T00:00:00+02:00">August 16, 2016</time></span></h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      
      <h1 class="entry-title">LDAP and password encryption strength</h1>
      
      <p>Given the focus on security breaches leaking account information the
last few years, we have taken a fresh look at how secure our LDAP
passwords really are, and if we can let OpenLDAP use a modern hash algorithm.</p>

<p>So what is a modern hash? <a href="https://crackstation.net/hashing-security.htm">Articles on the
net</a> usually mention
SHA-512, PBKDF-2, brypt and scrypt. The latter is considered better
as it consumes an arbitrarily large amount of memory and can thus be
more resistant to a GPU based attack.</p>

<h2 id="storing-passwords">Storing passwords</h2>

<p>OpenLDAP can store passwords in cleartext, as encrypted strings, or as
hashes (one-way algorithms). Usually one stores the password in the
userPassword attribute provided by or inherited from the
<code class="highlighter-rouge">organization</code>, <code class="highlighter-rouge">organizationalUnit</code> or <code class="highlighter-rouge">person</code> object class
(<a href="http://www.rfc-editor.org/rfc/rfc4519.txt">RFC4519</a>).</p>

<p>The userPassword attribute is in most installations by default protected with ACLs in the server
configuration, by only giving administrators or the owner of the
object containing the attribute access to this attribute.</p>

<p>The LDAP server content is in it self stored in a local database
backend, usually BDB or HDB.</p>

<p>In a worst case scenario, a malicious user can either somehow bypass
the LDAP server access protection and retrieve passwords or hashes via
the LDAP protocol, or somehow access the OS, get root privileges and
read the LDAP server’s database file from the file system. In these
cases, a strong password hash is imperative.</p>

<h2 id="openldap-built-in-security">OpenLDAP built-in security</h2>

<p>If the password content is prepended by a `{<keyword>}' string, the
LDAP server will use the given scheme to encrypt or hash the
password. Vanilla OpenLDAP 2.4 supports the following encryption schemes:</keyword></p>

<dl>
  <dt>MD5</dt>
  <dd>hashed password using the MD5 hash algorithm</dd>
  <dt>SMD5</dt>
  <dd>MD5 with salt</dd>
  <dt>SHA</dt>
  <dd>hashed password using the SHA-1 hash algorithm</dd>
  <dt>SSHA</dt>
  <dd>SHA-1 with salt</dd>
</dl>

<p>The SSHA is given as the most secure password scheme
supported. Unfortunately attacks against SHA-1 were found back in 2005
and the scheme has been officially frowned upon for a long time. The salt does
help, but SHA-1 is getting a bit long in the tooth. To put it mildly.</p>

<p><em>So is that it?</em></p>

<h2 id="openldap-pass-through-authentication">OpenLDAP pass-through authentication</h2>

<p>OpenLDAP can also use external processes to verify and hash passwords. These schemes are:</p>

<ul>
  <li>CRYPT - will use the OS’ crypt library as a password handler</li>
  <li>SASL - will use Cyrus SASL as a password handler</li>
</ul>

<p>Cyrus SASL was last updated in 2012, but CRYPT is a part of the POSIX
API and should be continuously updated. So - can CRYPT give us an
up-to-date hash?</p>

<h2 id="crypt-to-the-rescue">Crypt to the rescue</h2>

<p>It turns out that Linux based glibc versions of crypt support
additional encryption schemes through an additional versioning scheme
encoded in the password hash, This scheme is now defined as the <a href="https://github.com/P-H-C/phc-string-format/blob/master/phc-sf-spec.md">PHC
String format</a>.
The versions currently suppported in glibc crypt are:</p>

<table>
  <thead>
    <tr>
      <th>Scheme ID</th>
      <th>Schema</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>MD5</td>
    </tr>
    <tr>
      <td>2a</td>
      <td>Blowfish / bcrypt</td>
    </tr>
    <tr>
      <td>3</td>
      <td>NTHASH</td>
    </tr>
    <tr>
      <td>5</td>
      <td>SHA-256</td>
    </tr>
    <tr>
      <td>6</td>
      <td>SHA-512</td>
    </tr>
    <tr>
      <td>md5</td>
      <td>Solaris MD5</td>
    </tr>
    <tr>
      <td>sha1</td>
      <td>PBKDF1 with SHA-1</td>
    </tr>
  </tbody>
</table>

<p>The format used for the additional encryption schemes can be expressed
according to the PHC string format:
<code class="highlighter-rouge">$&lt;id&gt;[$&lt;param&gt;=&lt;value&gt;(,&lt;param&gt;=&lt;value&gt;)*][$&lt;salt&gt;[$&lt;hash&gt;]]</code>.  Here the salt and
the hash are Base64 encoded strings.</p>

<p>An interesting detail here is the parameter argument in the PHC formatted string - for
the sha-512 hash a valid argument is <code class="highlighter-rouge">rounds=&lt;N&gt;</code>, with a default
value of 5000. <em>This implements a key stretching scheme</em>.</p>

<p>So with SHA-512, a long salt and a high ‘rounds’ parameter, we should
be able to generate a reasonably secure hash. As of writing.</p>

<h2 id="openldap-default-password-variables">OpenLDAP default password variables</h2>

<p>You can instruct OpenLDAP to use a strong encryption scheme by default:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>password-hash {CRYPT}
password-crypt-salt-format "$6$%.16s"
</code></pre>
</div>

<p>Or for a cn=config enabled OpenLDAP server:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>olcPasswordHash: {CRYPT}
olcPasswordCryptSaltFormat: $6$%.16s
</code></pre>
</div>

<p>The latter setting’s value is in sprintf(3) format which should only contain
one % conversion. The string character count implies the length of the
salt, which for crypt can be up to 16 characters long.</p>

<p>In order to gain a longer key stretch, you can use:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>password-crypt-salt-format "$6$rounds=50000$%.16s"
</code></pre>
</div>

<p>I have unfortunately not had the time to test the key-stretching
default value, but will update this post with results later.</p>

<h2 id="mkpasswd-and-ldif">mkpasswd and LDIF</h2>

<p><code class="highlighter-rouge">mkpasswd</code> is a handy utility which can create a PHC formatted hash. In
the following example, I read a salt from /dev/random:</p>

<div class="language-terminal highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">mkpasswd</span><span class="kv"> --rounds 500000 -m sha-512 --salt `head -c 40 /dev/random | base64 | sed -e 's/+/./g' |  cut -b 10-25` 'Try to break this one!'
</span>$6$rounds=500000$KWcfAQjEPsey2aEr$X/E/I9ySD3zO6Z6cfrTo6MrSIMV5oNQuLjxg4kf4nB8f0WZLFuBYlQ86EkHatocuLB0ajd6DsHfmn8Bajoo9u/
</code></pre>
</div>

<p>Combined with LDIF we get the following hypothetical LDIF string in order to set a secure password for a given account:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dn: uid=lars,ou=Employees,dc=redpill-linpro,dc=com
changetype: modify
replace: userPassword
userPassword: {CRYPT}$6$rounds=500000$KWcfAQjEPsey2aEr$X/E/I9ySD3zO6Z6cfrTo6MrSIMV5oNQuLjxg4kf4nB8f0WZLFuBYlQ86EkHatocuLB0ajd6DsHfmn8Bajoo9u/
</code></pre>
</div>

<h2 id="further-steps">Further steps</h2>

<p>With the password storage in a better shape, don’t forget to ensure
that all communication with the LDAP server are encrypted!</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="https://www.redpill-linpro.com/techblog/tags/#LDAP" title="Pages tagged LDAP" class="tag"><span class="term">LDAP</span></a><a href="https://www.redpill-linpro.com/techblog/tags/#security" title="Pages tagged security" class="tag"><span class="term">security</span></a></span>
        
        
<div class="social-share">

  <ul class="socialcount socialcount-small inline-list">

  </ul>
  <ul class="socialcount socialcount-small inline-list">



  

    
    
    <li class="twitter">
      <a href="https://twitter.com/share?text=LDAP+and+password+encryption+strength&amp;url=https://redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html&amp;via=redpilllinpro" onclick="window.open(this.href, &#39;twitter-share&#39;, &#39;width=550,height=255&#39;);return false;" title="Share on Twitter">
        <span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    
    
    

  



  

    
    <li class="facebook">
      <a href="https://www.facebook.com/sharer.php?t=LDAP+and+password+encryption+strength&amp;u=https://redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html" onclick="window.open(this.href, &#39;facebook-share&#39;, &#39;width=550,height=255&#39;);return false;" title="Share on Facebook">
        <span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    
    
    
    

  



  

    
    
    
    

  



  



  

    
    
    
    
    <li class="linkedin">
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html" onclick="window.open(this.href, &#39;-share&#39;, &#39;width=550,height=255&#39;);return false;" title="Share on LinkedIn">
        <span class="count"><i class="fa fa-linkedin-square"></i> Share</span></a></li>
    

  



  



  



  



  

    
    
    
    <li class="googleplus">
      <a href="https://plus.google.com/share?title=LDAP+and+password+encryption+strength&amp;url=https://redpill-linpro.com/techblog/2016/08/16/ldap-password-hash.html" onclick="window.open(this.href, &#39;google_plus-share&#39;, &#39;width=550,height=255&#39;);return false;" title="Share on Google Plus">
        <span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
    
    

  


  </ul>
</div><!-- /.social-share -->

      </footer>
    </div><!-- /.entry-content -->
    
    


<div class="author-box">
  
  <div>
    <h2 class="author-name">Lars Olafsen</h2>
    <p><span class="author-title"><a href="https://redpill-linpro.com/">Operations Manager at Redpill&nbsp;Linpro</a></span></p>
    <p><span class="author-desc">Lars has been in the IT business for around two decades now, working initially both as a developer and systems administrator. He's been with Redpill Linpro for 9 years, and in addition to being one of our operations managers, he still gets the time to solder together pieces of code.
</span></p>
  </div>
  
  
</div>


    <div class="read-more">
  
  
  
  

    <div class="read-more-header">
      <a href="https://www.redpill-linpro.com/techblog/2016/08/12/btrfs-and-encryption.html" class="read-more-btn">More Posts</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="https://www.redpill-linpro.com/techblog/2018/11/16/local-development-environment-for-openshift.html" title="Local development environment for OpenShift">Local development environment for OpenShift</a></h3>
      <p></p><p>When developing software it makes sense to be able to work on local files, while the source code should be served from a controlled environment (a container) to prevent pollution of the developer workstation.</p> <p>In this article I will describe the evolution of a development workflow for deploying applications on OpenShift. The ultimate goal is to make it possible to maximize dev/prod parity, while minimizing the idle time in the change/test cycle.</p> <a href="https://www.redpill-linpro.com/techblog/2018/11/16/local-development-environment-for-openshift.html">... [continue reading]</a><p></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="https://www.redpill-linpro.com/techblog/2018/11/09/openshift-jenkins-pipeline.html" title="OpenShift with Jenkins for dev/prod parity">OpenShift with Jenkins for dev/prod parity</a></h4>
        <span>Published on November 09, 2018</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="https://www.redpill-linpro.com/techblog/2018/08/14/getting-started-with-terraform.html" title="Getting started with Terraform">Getting started with Terraform</a></h4>
        <span>Published on August 14, 2018</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span><a href="https://redpill-linpro.com/">© 2018 Redpill Linpro</a></span>


<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-31155331-1', 'auto');
  ga('send', 'pageview', {
        'page': '/techblog/2016/08/16/ldap-password-hash.html',
        'title': "LDAP and password encryption strength"
  });
</script>

<!-- Google Analytics end -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
  if (d.getElementById(i)){return;}
    var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
  n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/339956.js';
  e.parentNode.insertBefore(n, e);
})(document,"script","hs-analytics",300000);
</script>
<!-- End of Async HubSpot Analytics Code --> 


  </footer>
</div><!-- /.footer-wrapper -->

<script src="./LDAP and password encryption strength – _techblog_files/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/techblog/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="./LDAP and password encryption strength – _techblog_files/scripts.min.js"></script>



	        



</body></html>
FROM m_l/postfix_dovecot 
MAINTAINER Lian Ulloa l.ulloa@estudiantes.matcom.uh.cu

# COPY /mail/virtual /etc/postfix/
COPY /mail/ldap-virtual-alias-maps.cf /etc/postfix/ldap-virtual-alias-maps.cf
COPY /scripts/configure-ldap-client-using-expect.sh /root/
# COPY /scripts/install-mysql-server.sh /root/
# COPY /scripts/configure-mysql.sh /root/
# COPY /scripts/create-mail-database.sh /root/
# COPY /scripts/configure-phpmyadmin.sh /root/
COPY /scripts/start-postfix-ldap.sh /root/
COPY /scripts/.bashrc /etc/skel/
# COPY /scripts/exit.sh /root/

RUN chmod +x /root/configure-ldap-client-using-expect.sh
# RUN chmod +x /root/install-mysql-server.sh
# RUN chmod +x /root/configure-mysql.sh
# RUN chmod +x /root/create-mail-database.sh
# RUN chmod +x /root/configure-phpmyadmin.sh
RUN chmod +x /root/start-postfix-ldap.sh
# RUN chmod +x /root/exit.sh


# DOVECOT SPECIFIC CONFIGURATION
RUN mv /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.backup
COPY /mail/dovecot.conf /etc/dovecot/
COPY /mail/mail.key /etc/ssl/private/mail.key
COPY /mail/mailcert.pem /etc/ssl/certs/mailcert.pem
COPY /scripts/start-dovecot.sh /root/
RUN chmod +x /root/start-dovecot.sh


ENTRYPOINT [ "/root/start-postfix-ldap.sh" ]

# TENER EN CUENTA QUE HAY QUE AGREGAR LOS NUEVOS USUARIOS AL ARCHIVO VIRTUAL DE POSTFIX
# Y CREAR EL HOME DE CADA USUARIO DE MANERA AUTOMATICA LOGUEANDO EL USUARIO
# REINICIAR POSTFIX
# Y YA LUEGO SE PUEDEN ENVIAR CORREOS CON EL CLIENTE DE CONSOLA

# EXPOSE 80 443

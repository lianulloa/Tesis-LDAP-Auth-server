\chapter{Directorio Único}

\section{Surgimiento del Directorio Único}

Directorio Único es un servicio, que fue implementado con el objetivo de acceder a los datos 
del personal de la Universidad de la Habana. En el momento de su surgimiento, se hacia 
necesario disponer de un sistema que unificara las principales fuentes de datos de 
trabajadores y estudiantes. De esta manera sería factible presentarlas a través de una misma
interfaz. Desde su creación se han implementado, sobre dicha interfaz, varios 
servicios de manera escalonada. Entre los principales servicios implementados, podemos 
destacar la implementación de un mecanismo de autenticación OAuth para los sitios de la 
intranet. Todos los servicios implementados sobre directorio funcionan hasta hoy. Otros 
servicios permiten denegar o permitir el acceso de los usuarios a determinados recursos 
brindados por la Universidad. Se puede tomar como ejemplo, el acceso al servicio que 
administra la asignación de viajes internacionales al personal de la Universidad. Otro 
ejemplo, un poco más palpable, lo tenemos en el servicio que decide la cuota de internet 
asociada a cada usuario. Este se basa tanto, en el año que cursa, en caso de ser estudiante,
como en el cargo que ocupa o departamento en que trabaja, en el caso de los trabajadores.

Todos estos servicios, se implementaron sobre una misma base, debido al proceso de 
centralización iniciado hace ya 4 años. Dicha centralización nos provee de ciertas ventajas,
ya que representa una fuente de información de todo el personal de la Universidad de La 
Habana. Con este enfoque, la información queda más accesible y más fácil de administrar. 

Sin embargo, esta información no se genera de forma centralizada, sino que se encuentra 
esparcida entre distintas fuentes. Primeramente contamos con el Sistema de Gestión para la 
Nueva Universidad (SIGENU). La información almacenada en esta, es administrada por las 
secretarias de las respectivas facultades y es referente solo a los estudiantes. También se
consume información de los trabajadores de la Universidad de La Habana, la cual se maneja 
por los departamentos de recursos humanos de cada una de las unidades presupuestadas de la 
Universidad (UH, IFAL, JBN, UPA, ISDI, INSTEC). Sobre esta no se tiene total 
acceso debido a que, para su creación y luego su administración, se utiliza un software 
privativo.

Entre los datos más relevantes, almacenados en el Directorio Único, se encuentran aquellos 
que permiten la restricción y/o concesión de acceso a los servicios brindados. Es decir, 
las credenciales de los usuarios de la red. Esta información permite:

\begin{enumerate}
\item {\bf Autenticar al usuario:} Comprobar que la persona que solicita un servicio es 
quien dice ser.
\item {\bf Administrar el acceso:} En correspondencia del nivel de privilegio de un usuario 
,permitir o no el acceso a ciertos servicios.
\end{enumerate}

Una parte de la información almacenada, contiene información personal de los usuarios,
estando esta más asociada a los trabajadores y externos. Entre la 
misma sobresalen: 
\begin{enumerate}
	\item Año que cursa (en caso de ser estudiante)
	\item Direcci\'on Particular
	\item Departamento al que pertenecen
	\item Datos sobre la nomina
	\item Puesto que ocupa
	\item Cargos importante (si es que los pos\'ee)
\end{enumerate}

A los datos que actualmente se mantienen en el sistema, se le asocia información adicional
para conocer la actividad realizada por el usuario. Dicha información, la almacenad el nodo
de la Universidad en otro sistema aparte. Durante su estancia en la red, podemos registrar
los momentos en que se autentica , en que sistema lo hace, la cantidad de cuota de internet
consumida, etc.

En el listado siguiente, se encuentra un ejemplo de una posible respuesta ofrecida por el 
directorio cuando se consultan los datos de un trabajador de la UH.

\begin{verbatim}
	<TrabajadorInfoCuote>
	<Id>15869</Id>
	<CatOcupacional>técnicos docentes principal</CatOcupacional>
	<Docente>Si</Docente>
	<CatDocenteInvestigativa>Instructor</CatDocenteInvestigativa>
	<Contrato>Indeterminado</Contrato>
	<Cargo>INSTRUCTOR</Cargo>
	<Adiestrado>No</Adiestrado>
	<AdministradorArea>No</AdministradorArea>
	<Tecnico>Si</Tecnico>
	<TecnicoInformatico>No</TecnicoInformatico>
	<EspecialistaPrincipal>No</EspecialistaPrincipal>
	<Cuadro>No</Cuadro>
	<Asset>1</Asset>
	<Departamento>DIRECCION DE INFORMATIZACION</Departamento>
	</TrabajadorInfoCuote>
\end{verbatim}

\section{Problemas del sistema actual}

El sistema, tal y como existe en este momento, presenta varios problemas. Esta tesis 
pretende brindar una propuesta de solución, así como su implementación. Los problemas son 
presentados a continuación:

\subsection{Mantenimiento y extensión del Sistema}

Debido a la naturaleza del surgimiento del Directorio Único, es decir, el acoplamiento 
de varios servicios de manera escalonada sobre la idea inicial, cada componente es 
demasiado dependiente de la forma en que las demás brindan sus correspondientes 
funcionalidades. Esto se debe a que la interacción entre las mismas ha sido configurada 
mediante un enfoque estático. El propio sistema no dispone de herramientas que permitan su 
modificación de una manera cómoda para los encargados de su mantenimiento. Dicho enfoque 
dificulta enormemente las tareas de actualización del sistema, las cuales son necesarias 
para poder adecuar el mismo a las nuevas condiciones y necesidades que van surgiendo en la 
red a través de los años. De hecho, actualmente el personal encargado del mantenimiento de
Directorio no puede responder a las necesidades de actualización. La principal causa de 
esta desatención, es que los desarrolladores de Directorio perdieron muchos de los cambios
en su historial de código. Tan importante es la pérdida de este historial que imposibilita
la recuperación de la lógica del Directorio actual partiendo solamente del código almacenado.

\subsection{Desuso de datos almacenados}

Desde el surgimiento del Directorio Único, se han ido incorporando nuevos campos a las 
fuentes de información del sistema. Estos cambios han tenido como objetivo suplir las 
necesidades que ocupan a la Universidad en cada nuevo período escolar. 

Actualmente muchos de esos campos han dejados de ser útiles para la Universidad. Como
consecuencia de la rigidez del Directorio, cualquier cambio, sobre todo aquellos cuya 
repercusión y alcance no se conocen, podrían significar la caída del sistema por tiempo 
indefinido. De ahí que se siga la filosofía de que "... lo que funciona no se toca...". Pero
mantener este enfoque, provoca una sobrecarga innecesaria para el sistema, que aunque pueda
ser pequeña, no deja de ser significante. Dicha sobrecarga se refleja sobre todo en el 
espacio ocupado por la información en disco.

\subsection{Incumplimiento de políticas de baja de usuarios}

Este es otro problema en el cual se incurre con bastante frecuencia en la Universidad. 
Debido a la volatilidad de algunos contratos concertados con personal ajeno a nuestro 
centro de altos estudios. 

Sucede frecuentemente que al dar de baja a estos usuarios, sus cuentas son eliminadas con 
efecto casi inmediato, lo cual va en contra de los protocolos usualmente implementados en 
estos casos. Generalmente se debe espera una cierta cantidad de días para implementar la 
eliminación total de las cuentas. De esta manera se puede prevenir la pérdida de acceso a 
servicios críticos, como son el correo, el proxy y la nube recientemente desplega en la 
intranet de la Universidad. Muchas veces estos servicios son desarrollados, administrados 
y mantenidos por agentes externos a la Universidad. 


\subsection{Carencia de protocolos comunes para servicios externos}

A menudo, se implementan nuevos servicios en la red de la Universidad. Generalmente estos
servicios necesitan tener control de acceso sobre los recursos que brindan a sus usuarios.
Esto implica el tener que desarrollar para cada nuevo servicio, un mecanismo de 
autenticación de usuarios. Este mecanismo además tiene que ser capaz de brindar una 
funcionalidad para administrar los roles o grupos a los que pertenecen dichos usuarios.
Un enfoque más útil, es el de delegar esta tarea a un sistema externo y centralizado. De
esta forma se evita el tener que repetir el desarrollo de la misma funcionalidad para cada
servicio.

Teniendo esto en cuenta, es que se pretende implementar una API Rest que permita modificar 
la lógica detrás de la información brindada, sin que esto implique modificar todos los 
servicios que consuman información de nuestro sistema.

\section{Propuesta de solución}

Con el objetivo de subsanar dichos problemas, pretendemos desarrollar un sistema capaz de
sustituir el Directorio Único. Nuestro enfoque va orientado a desplegar un servidor que
implemente el protocolo LDAP. Este protocolo define un servicio de directorio optimizado para
las operaciones de búsqueda. Además posee facilidades para la organización de los datos, 
asociándolos a entidades, grupos y cualquier otra unidad organizacional en la que se necesiten
agrupar a los datos. Dichos datos serán consumidos directamente de las mismas fuentes de las
que se alimenta Directorio Único. Existirá, para esto, un capa de software intermedio capaz de
transformar los datos a un formato compatible con el protocolo LDAP. Y en caso de que se
necesite guardar alguna información que no este incluida en las fuente, es en esta capa donde
será generada.

Actualmente existe muchos servicios que saben como comunicarse directamente con el protocolo
LDAP. Pero no todos incluyen esta funcionalidad. Es debido a esto, que es necesario implementar
una interfaz, una capa de abstracción entre LDAP y el resto de los servicios, que permita su
comunicación. El protocolo de comunicación más común entre servicios web es el de HTTP. Por eso
pretendemos implementar una RESTFUL Api para garantizar la interacción de nuestro sistema, con
todos los servicios que puedan necesitar consumir la información que almacenaremos. Los servicios
que brindara dicha Api son los siguiente:

\begin{enumerate}
	\item Consultar la información acerca de cualquiera de las usuario almacenados en el sistema,
	siempre y cuando cuente con el permiso necesario.
	\item Introducir y actualizar la información de los usuarios, tanto de estudiantes, como de 
	trabajadores y externos.
	\todo[inline, color=yellow]{no se si las puse muy genericas? se me queda algo fuera?}
\end{enumerate}

El capítulo siguiente presentaremos las tecnologías usadas como base para la implementación del
sistema.




